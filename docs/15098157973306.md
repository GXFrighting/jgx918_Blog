# iOS 多线程简介

* [x] [线程和线程的比较](#进程和线程的比较)
* [x] [多线程概念](#多线程概念)
* [x] [多线程原理](#多线程原理)
* [x] [多线程的优缺点](#多线程的优缺点)
* [x] [多线程在iOS开发中的应用](#多线程在iOS开发中的应用)

## <span id = "进程和线程的比较">进程和线程的比较</span>
> 线程是CPU调度（执行任务）的最小单位。
> 进程是CPU分配资源和调度的单位。
> 一个程序可以对应多个进程，一个进程中可以有多个线程，但至少有一个线程。
> 同一个进程里的线程共享进程的资源。

## <span id = "多线程概念">多线程概念</span>
> 一个进程中可以开启多条线程，每条线程可以并行（同时）执行不同的任务。

## <span id = "多线程原理">多线程原理</span>
* 同一时间，CPU只能处理一条线程，只有一条线程在工作。
* 多线程并发执行，其实是CPU快速地在多条线程之间调度（切换）。

## <span id = "多线程的优缺点">多线程的优缺点</span>
* 优点
    - 能适当提高程序的执行效率
    - 能适当提高资源利用率（CPU、内存利用率）
* 缺点
    - 创建线程是有开销的，iOS下主要成本包括：内核数据结构（大约1KB），栈空间（子线程512KB，主线程1MB，也可以使用-setStackSize: 设置，但必须是4K的倍数，而且最小是16K），创建线程大约需要90毫秒的创建时间
    - 如果开启大量的线程，会降低程序的性能
    - 线程越多，CPU在调度线程上的开销就越大
    - 程序设计更加复杂：比如线程之间的通信、多线程的数据共享

## <span id = "多线程在iOS开发中的应用">多线程在iOS开发中的应用</span>
* 什么是主线程

> 一个iOS程序运行后，默认会开启一条线程，称为“**主线程**” 或 “**UI线程**”
 
* 主线程的主要作用

> 显示、刷新UI界面
> 处理UI事件（点击、滚动、拖拽等）

* 主线程的使用注意

> 别将比较耗时的操作放到主线程中
> 耗时操作会卡住主线程，严重影响UI的流畅度，给用户一种“卡”的体验


```flow
st=>start: 开始
e=>end: 结束
op=>operation: 我的操作
cond=>condition: 确认？

st->op->cond->op
cond(yes)->e
cond(no)->op
```

```flow
st=>start: 新建NEW
op=>operation: 就绪Runnable
op2=>condition: 就Runnable
e=>end: 死亡Dead
st->op->op2->e

```

